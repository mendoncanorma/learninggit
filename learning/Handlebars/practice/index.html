<html>

<head>
    <title>Example: Handlebars</title>    
    <script src="jquery-1.11.3.min.js"></script>
    <script src="handlebars-v4.0.5.js"></script>
    <style type="text/css">
        .redText {color: red;}
        .greenText {color: green;}
        .blueText {color: blue;}
        .mybold{font-weight: bold;}
        #nav-bar {border: 1px solid red;}
    </style>
</head>

<body>
    
    <div id="html-block-helper"></div>
    
    <div id="html-block-helper-1"></div>
    
    <div id="html-with-block-helper"></div>
    
    <div id="html-each-block-helper"></div>
    
    <div id="html-each-block-helper-2"></div>
    
    <script id="tmpl-block-helper" type="text/x-handlebars-template">
        <h3>The 'Block Helpers'</h3>
        
        <div class="entry">
            <h1>{{title}}</h1>
            <div class="body">
                {{#noop}}{{body}}{{/noop}}
            </div>
        </div>        
    </script>
    
    <script id="tmpl-block-helper-1" type="text/x-handlebars-template">
        <div class="entry">
            <h1>{{title}}</h1>
            <div class="body">
                {{#bold}}{{body}}{{/bold}}
            </div>
        </div>        
    </script>
    
    <script id="tmpl-with-block-helper" type="text/x-handlebars-template">
        <div class="entry">
            <h1>{{title}}</h1> 
            
            {{#with story}}
            <div class="intro">{{{intro}}}</div>
            <div class="body">{{{body}}}</div>
            {{/with}}
            
        </div>       
    </script>
    
    <script id="tmpl-each-block-helper" type="text/x-handlebars-template">
        <div class="comments">
            {{#each comments}}
            <div class="comment">
                <h2>{{@index}} - {{subject}}</h2> {{{body}}}
            </div>
            {{/each}}
        </div>      
    </script>
    
    <script id="tmpl-each-block-helper-2" type="text/x-handlebars-template">
        {{#list nav id="nav-bar" class="top"}}
            <a href="{{url}}">{{@index}}-{{title}}</a>
        {{/list}}
    </script>
        
    <script type="text/javascript">
        
        /* *************************************************************************** */
        
        Handlebars.registerHelper('noop', function (options) {
            console.log(options.fn(this));
            return options.fn(this);
        });
        
        
        Handlebars.registerHelper('bold', function (options) {
            var output = "<div class='mybold'>";
            output += options.fn(this);
            output += "</div>";
            return output;
        });
        
        
        Handlebars.registerHelper('with', function(context, options) { 
            return options.fn(context); 
        });
        
        Handlebars.registerHelper('each', function(context, options) {
            // console.log(options.fn(this));
            
            var output = "<ul>";
            for(var i=0; i<context.length; i++) {
                // console.log(options.fn(context[i]));
                output += "<li>" + options.fn(context[i]) + "</li>";     
            }
            output += "</ul>"
            
            return output;
        });
        
        Handlebars.registerHelper('list', function(context, options) {
            
            // console.log(options.fn(this));
            
            var attrs = "";
            for(var i in options.hash) {
                attrs += i + "=" + options.hash[i] + " ";
            }
            
            var data;
            if (options.data) {
                data = Handlebars.createFrame(options.data);
            }

            var output = "<ul "+attrs+">";
            for(var i=0; i<context.length; i++) {
                // console.log(options.fn(context[i]));
                if (data) {
                    data.index = i;
                }                
                output += "<li>" + options.fn(context[i], { data: data }) + "</li>";     
            }
            output += "</ul>"
            
            return output;            
        });
        /* *************************************************************************** */
        
        var data1 = {
            title: "Block Helpers Heading",
            body: "Block Helpers Body"
        };
        
        var source1   = $("#tmpl-block-helper").html();
        var template1 = Handlebars.compile(source1);
        var html1     = template1(data1);
        $('#html-block-helper').html( html1 );
        
        /* *************************************************************************** */
        
        var data2 = {
            title: "Block Helpers Heading",
            body: "Block Helpers Body"
        };
        
        var source2   = $("#tmpl-block-helper-1").html();
        var template2 = Handlebars.compile(source2);
        var html2     = template2(data2);
        $('#html-block-helper-1').html( html2 );
        
        /* *************************************************************************** */        
        
        var data3 = {
            title: "First Post", 
            story: { 
                intro: "Before the jump", 
                body: "After the jump" 
            }
        };
        
        var source3   = $("#tmpl-with-block-helper").html();
        var template3 = Handlebars.compile(source3);
        var html3     = template3(data3);
        $('#html-with-block-helper').html( html3 );
        
        /* *************************************************************************** */    
        
        var data4 = {
            comments: [
                {subject: "subject 1", body: "body 1"},
                {subject: "subject 2", body: "body 2"},
                {subject: "subject 3", body: "body 3"},
                {subject: "subject 4", body: "body 4"}
            ]
        };
        
        var source4   = $("#tmpl-each-block-helper").html();
        var template4 = Handlebars.compile(source4);
        var html4     = template4(data4);
        $('#html-each-block-helper').html( html4 );
        
        /* *************************************************************************** */
        
        var data5 = {
            nav: [
                { url: "http://www.yehudakatz.com", title: "Katz Got Your Tongue" },
                { url: "http://www.sproutcore.com/block", title: "SproutCore Blog" },
            ]
        };
        
        var source5   = $("#tmpl-each-block-helper-2").html();
        var template5 = Handlebars.compile(source5);
        var html5     = template5(data5);
        $('#html-each-block-helper-2').html( html5 );
        
        /* *************************************************************************** */                     
    </script>
        
</body>

</html>