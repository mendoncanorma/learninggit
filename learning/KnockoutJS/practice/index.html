<html>

<head>
    <title>KO Shopping Cart</title>
    <link href="css/bootstrap.css" type="text/css" rel='stylesheet' />
    <link href="css/iCheck/skins/all.css" type="text/css" rel='stylesheet' />
    <link href="css/style.css" type="text/css" rel='stylesheet' />
</head>

<body>

    <div id="page">

        <div class="container-fluid">
            
            <div class="row" id="catalogContainer" data-bind="visible: visibleCatalog">
                <div class="col-xs-12" data-bind="template: {name: 'header'}"></div>
                
                <div class="col-xs-6" data-bind="template: {name: 'catalog'}"></div>

                <div class="col-xs-6" data-bind="if: visibleCart" id="cartContainer">
                    <div class="well" data-bind="template: {name: 'cart'}"></div>
                </div>
            </div>

            <div class="row" id="orderContainer" data-bind="ifnot: visibleCatalog">
                <div data-bind="template: {name: 'order'}"></div>
            </div>

            <div data-bind="template: {name: 'add-to-catalog-modal'}"></div>
            <div data-bind="template: {name: 'finish-order-modal'}"></div>

        </div>

    </div>
        
    <div data-bind="event: {mouseover: showDebug, mouseout: hideDebug}">
        <h3 style="cursor: pointer">Place the mouseover to display debug</h3>
        <pre class="well well-lg" data-bind="visible: debug, toJSON: $root"></pre>
    </div>
    <!--
    <pre data-bind="text: ko.toJSON($root, null, 2)"></pre>
    -->

    <!-- Start : Templates -->
    <script type="text/html" id="header">
        <h1>Catalog</h1>
        <button class="btn btn-primary btn-sm" 
                data-toggle="modal" 
                data-target="#addToCatalogModal">Add New Product</button>
        <!-- <button class="btn btn-primary btn-sm"
                data-bind="click: showCartDetails, enable: cartHasProducts">Show Cart Details</button> -->
            <button class="btn btn-primary btn-sm"
                data-bind="toggle: visibleCart, enable: cartHasProducts">Show Cart Details</button>
        <hr />
        <input type="checkbox" id="showSearchBar" data-bind="icheck, checked: showSearchBar"/> Show Search options        
    </script>

    <script type="text/html" id="catalog">
        <div class="input-group" data-bind="visible: showSearchBar">
            <span class="input-group-addon">
                <i class="glyphicon glyphicon-search"></i> Search</span>
            <input type="text" 
                    class="form-control" 
                    data-bind="textInput: searchTerm, executeOnEnter: filterCatalog"
                    placeholder="Press enter to search..." />
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th></th>
                </tr>
            </thead>
            <tbody data-bind="foreach:catalog">
                <tr data-bind="css: hasStock">
                    <td data-bind="text: $data.id"></td>
                    <td><a href="/" data-bind="text: $data.name, click: $parent.showDescription"></a></td>
                    <td data-bind="currency: $data.price, symbol: '$'"></td>
                    <td data-bind="text: $data.stock"></td>
                    <td>
                        <!-- 
                        <button class="btn btn-primary"
                                data-bind="click: $parent.addToCart">
                            <i class="glyphicon glyphicon-plus-sign"></i> Add
                        </button>
                        -->

                        <add-to-cart-button params="{cart: $parent.cart, item: $data}"></add-to-cart-button>

                    </td>
                </tr>
            </tbody>
            <tfoot>
                <td colspan="4">
                    <strong>Items:</strong><span data-bind="text:catalog().length"></span>                    
                </td>
                <td colspan="1">
                    <span data-bind="template:{name:'cart-widget'}"></span>
                </td>
            </tfoot>
        </table>        
    </script>

    <script type="text/html" id="add-to-catalog-modal">
        <div class="modal fade" id="addToCatalogModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form class="form-horizontal" role="form" data-bind="with:newProduct">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span aria-hidden="true">&times;</span>
                                <span class="sr-only">Close</span>
                            </button>
                            <h3>Add New Product to the Catalog</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <input type="text" class="form-control" placeholder="ID" data-bind="textInput:id">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <input type="text" class="form-control" placeholder="Name" data-bind="textInput:name">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <input type="text" class="form-control" placeholder="Price" data-bind="textInput:price">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <input type="text" class="form-control" placeholder="Stock" data-bind="textInput:stock">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <button type="submit" class="btn btn-default" data-bind="{click:$parent.addProduct}">
                                        <i class="glyphicon glyphicon-plus-sign"></i> Add Product
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
    </script>

    <script type="text/html" id="cart-widget">
        Total Items: <span data-bind="text:totalItems"></span>
        Price: <span data-bind="currency:grandTotal, symbol: '$'"></span>        
    </script>

    <script type="text/html" id="cart-item">
        <div class="list-group-item">
            <button type="button" class="close pull-right" data-bind="click:$root.removeFromCart"><span>&times;</span></button>
            <h4 class="" data-bind="text:product.name"></h4>
            <div class="input-group cart-unit">
                <input type="text" class="form-control" data-bind="textInput:units" readonly/>
                <span class="input-group-addon">
                    <div class="btn-group-vertical">
                        <!-- <button class="btn btn-default btn-xs" data-bind="click:addUnit">
                            <i class="glyphicon glyphicon-chevron-up"></i>
                        </button>
                        <button class="btn btn-default btn-xs" data-bind="click:removeUnit">
                            <i class="glyphicon glyphicon-chevron-down"></i>
                        </button> -->
                        <button class="btn btn-default btn-xs add-unit">
                            <i class="glyphicon glyphicon-chevron-up"></i>
                        </button>
                        <button class="btn btn-default btn-xs remove-unit">
                            <i class="glyphicon glyphicon-chevron-down"></i>
                        </button>
                    </div>
                </span>
            </div>
        </div>
    </script>

    <script type="text/html" id="cart">
        <!-- <button type="button" class="close pull-right" data-bind="click:hideCartDetails">
            <span>&times;</span>
        </button> -->
        <button type="button" class="close pull-right" data-bind="toggle: visibleCart">
            <span>&times;</span>
        </button>

        <h1>Cart</h1>

        <div data-bind="template: {name: 'cart-item', foreach:cart}" class="list-group"></div>
        
        <div data-bind="template:{name:'cart-widget'}"></div>
        
        <!-- <button class="btn btn-primary btn-sm" data-bind="click:showOrder">Confirm Order</button> -->
        <button class="btn btn-primary btn-sm" id="confirmOrderBtn">Confirm Order</button>
    </script>

    <script type="text/html" id="order">
        <div class="col-xs-12">
            <button class="btn btn-sm btn-primary" data-bind="click:showCatalog">Back to catalog</button>
            <button class="btn btn-sm btn-primary" data-bind="click:finishOrder">Buy &amp; finish</button>
        </div>
        <div class="col-xs-6">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Units</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach:cart">
                    <tr>
                        <td data-bind="text:product.name"></td>
                        <td data-bind="currency: product.price, symbol: '$'"></td>
                        <td data-bind="text:units"></td>
                        <td data-bind="currency:subtotal, symbol: '$'"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3"></td>
                        <td>Total:<span data-bind="currency:grandTotal, symbol: '$'"></span></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </script>

    <script type="text/html" id="finish-order-modal">
        <div class="modal fade" id="finishOrderModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <h2>Your order has been completed!</h2>
                    </div>
                    <div class="modal-footer">
                        <div class="form-group">
                            <div class="col-sm-12">
                                <button type="submit" class="btn btn-success" data-dismiss="modal">Continue Shopping
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->       
    </script>
    <!-- End : Templates -->


    <script src="../jquery-1.11.3.min.js"></script>
    <script src="../bootstrap.min.js"></script>
    <script src="../knockout-3.4.0.js"></script>
    <script src="icheck-1.x/icheck.js"></script>
    <script src='js/vendor/jquery.mockjax.js'></script>
    <script src='js/vendor/jquery.mockjson.js'></script>

    <script src='mocks/product.js'></script>

    <script src="js/custom/koBindings.js"></script>
    <script src="js/custom/components.js"></script>
    <script src="js/custom/events.js"></script>
    <script src="js/resources/ProductResource.js"></script>
    <script src="js/models/product.js"></script>
    <script src="js/models/cart-product.js"></script>
    <script src="js/services/ProductService.js"></script>
    <script src="js/services/CartProductService.js"></script>
    <script src="js/view-model.js"></script>


</body>

</html>