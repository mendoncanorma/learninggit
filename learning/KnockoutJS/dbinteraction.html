<html>

<head>
    <title>Example: DB Interaction</title>
    <link href="bootstrap.css" type="text/css" rel="stylesheet" />
    <script src="jquery-1.11.3.min.js"></script>
    <script src="knockout-min.js"></script>
</head>

<body>

    <div id='page-wrapper'>
        <nav class="navbar navbar-default">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">GoalTracker</a>
                </div>
            </div>
        </nav>

        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <input 
                           type="text" 
                           name="name" 
                           id="name" 
                           class="form-control" 
                           placeholder="Enter Goal" 
                           data-bind="value: goalInputName" />
                </div>
                <div class="col-md-3">
                    <select 
                            name="type" 
                            id="type" 
                            class="form-control"
                            data-bind="value: goalInputType, options: types, optionsCaption: 'Choose Type'">
                    </select>
                </div>
                <div class="col-md-3">
                    <input 
                           type="date" 
                           name="deadline" 
                           id="deadline" 
                           class="form-control"
                           data-bind="value: goalInputDeadline">
                </div>
                <div class="col-md-3">
                    <button 
                            class="btn btn-primary"
                            data-bind="click: addGoal">Add Goal</button>
                    <button class="btn btn-danger">Delete</button>
                </div>
            </div>
            <br>
            <br>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Deadline</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: goals">
                            <tr>
                                <td><input type="checkbox"></td>
                                <td data-bind="text: name"></td>
                                <td data-bind="text: type"></td>
                                <td data-bind="text: deadline"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
        <!-- /.container -->
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            
            function getGoals() {
                $.get('dbgetgoals.php', function (data) {
                    viewModel.goals(data); 
                });
            }
            
            function ViewModel () {
                var self    = this;
                
                self.goals  = ko.observableArray();
                
                self.goalInputName = ko.observable();
                self.goalInputType = ko.observable();
                self.goalInputDeadline = ko.observable();
                
                self.addGoal = function () {
                    var name        = $('#name').val(),
                        type        = $('#type').val(),
                        deadline    = $('#deadline').val();
                    
                    self.goals.push({
                        name: name,
                        type: type,
                        deadline: deadline
                    });
                    
                    $.ajax({
                        url: 'dbsetgoals.php',
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify({
                            "name": name,
                            "type": type,
                            "deadline": deadline
                        }),
                        success: function (data) {
                            console.log('Goal Added...');
                        },
                        error: function (xhr, status, err) {
                            console.log(err);
                        }
                    });
                };
                
                self.types = ko.observableArray(['Type 1', 'Type 2', 'Type 3', 'Type 4', 'Type 5']);
            }
            
            var viewModel = new ViewModel();
            
            ko.applyBindings(viewModel);
            
            getGoals();
            
        });
    </script>
</body>

</html>